---
title: "Data Management final project Mar√©chal-Volaris"
format: pdf
editor: visual
---


```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
here::i_am("DM-Project-Marechal-Volaris.Rproj")
library(here)
library(vroom)
clean_merged <- vroom("clean_merged.csv")
library(dplyr)
library(tidyr)
library(ggplot2)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(fig.align = "center")
```

# 1. Presentation of the Research Question

Cleaning and merging the datasets allows us to obtain a clearer view of the question we are aiming to answer to: to what extent socio-economical factors have influenced the impact of the Covid-19 pandemic throughout the United States? Although Covid has been a global issue, it is fair to state that the United States were among the most impacted countries: according to the Centers for Disease Control and Prevention, almost 1.2 millions Americans have died of Covid-related complications, the most of any country worldwide. Once we take into account the overall populations, indicators are still concerning and should prompt us to try to understand better what can explain them. For example, the mortality rate (the ratio between total death and total cases reported) is equal to 1.17%, whereas it is only 0.43% in France. Such difference is explained thanks to various socio-economical factors, as well as political decisions. For example, the American healthcare system, relying on private companies rather than a mandatory public option, has been criticized for its negative impact on overall public health. Studying how uninsured Americans have been affected by the pandemic would therefore helps us understand if the weaknesses of the healthcare system played a role in an increased mortality rate. In addition to this first approach, our datasets allow us to study in a deeper way how economical and social differences may have played a role in how the mortality rate has evolved in various regions. The `counties` dataset, for example, provides us with a full racial make-up of each county-equivalent in the country, as well as basic economic indicators, such as the median income or the unemployment rate. To answer to our research question, we have chosen to base our study on the county-level, in order to get a more precise view of the country, which would not have been possible on the state-level.

# 2. Understanding Data

## 1. Dataset Descritption

## A - Dataset

To pursue our study, we need to establish per capita variables. Indeed, counties have widely varying populations.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  group_by(name) |>
  select(name, state, pop_2019) |>
  summarize(state=state,
            population=pop_2019) |>
  arrange(population)
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  group_by(name) |>
  select(name, state, pop_2019) |>
  summarize(state=state,
            population=pop_2019) |>
  arrange(-population)
```

As we can see, in 2019, a county population ranges from 66 (Kalawao County, Hawaii) to more than 10 millions habitants (Los Angeles County, California). Aware of this disparity, we establish two per capita variables: the infection rate and the mortality rate. They are defined as: Infection rate=Total of confirmed cases/Total county population Mortality rate=Total death from Covid 19/Total of confirmed cases For a better understanding, we express these rates as percentages by multiplying them by 100.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged <- clean_merged |>
  mutate(Death_rate = ifelse(`Total Confirmed` > 0, (`Total Death` / `Total Confirmed`) * 100, NA)) |>
  mutate(Infection_rate = ifelse( pop_2019 > 0, (`Total Confirmed` / pop_2019) * 100, NA)) |>
  mutate( medically_underserved_dummy = ifelse(
      !is.na(`Designation Population in a Medically Underserved Area/Population (MUA/P)`) |
      !is.na(`Medically Underserved Area/Population (MUA/P) Total Resident Civilian Population` ) |
      !is.na(`Providers per 1000 Population`), 
      1, 
      0)) |>
   mutate(Aggregate_connectivity = ifelse(
      !is.na(household_has_broadband_2019) |
      !is.na(household_has_computer_2019) |
      !is.na(household_has_smartphone_2019),
      rowMeans(cbind(household_has_broadband_2019,household_has_computer_2019, household_has_smartphone_2019), na.rm = TRUE),
      0))
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  group_by(fips) |>
  select(name, Infection_rate) |>
  summarise(Infection_rate,
            name) |>
  arrange(-Infection_rate)
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  group_by(fips) |>
  select(name, Death_rate) |>
  summarise(Death_rate,
            name) |>
  arrange(-Death_rate)
```

We notice that two county-equivalents have infection rate higher than 100%. This abnormality can be explained by various reasons, such as an error in the database, a decline in population, a center diagnosing cases from neighboring counties, ... For the sake of our study, we can drop these outliers.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged <- clean_merged |>
  filter(Infection_rate<100)
```

In order to understand these two variables better, we represent them graphically. As continuous variables, a density function seems to be the best way to do so.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=Infection_rate))+
  geom_density()
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  pull(Infection_rate) |>
  quantile(probs=seq(0, 1, by=0.1), na.rm=TRUE)
```

Covid has a heterogeneous impact on the United States, with 80% of counties having an infection rate ranging from 22.45% to 38.46%.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=Death_rate))+
  geom_density()
```

We can notice that both rates are distributed following a roughly normal law, centered around 30% for `Infection_rate` and a 1.2% for `Death-rate`. The disparities observed are significant, some counties having a death rate superior to 4%. These disparities are clearly shown by the quantiles of the `Death_rate` variable.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  pull(Death_rate) |>
  quantile(probs=seq(0, 1, by=0.1), na.rm=TRUE)
```

Here, we can notice a clear difference between quantiles: the two extremes are 0.73% and 2.2%. Therefore, we can ask ourselves what can explain such differences between counties.

# 3. Data Analysis and Interpretation

## I. Analysis of Demographic Data

### Age

It is safe to state that the age is among the most important factors explaining Covid-19 mortality. Older people represent a majority of fatalities from the disease and are more sensible to its symptoms. Our dataset provides us with various variables regarding age. We can first test how the percentage of people older than 65 years old impact the death rate within a county.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=age_over_65_2019))+
  geom_density()
```

Most counties have an elder population representing between 10 and 30% of its citizens. As a numeric continuous variable, we can establish classes in order to obtain an overview of the variable and its correlation with the death rate from Covid.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  mutate(elder_class = cut(age_over_65_2019,
                          breaks = seq(0, 100, 5), 
                          include.lowest = TRUE)) |>
  ggplot(aes(y=elder_class, x=Death_rate, fill=elder_class))+
  geom_violin()
```

The graph seems to indicate a positive correlation between the two variables: the higher the population over 65 years old, the higher the mortality from Covid. This hypothesis prompts us to test a linear regression model involving the two variables.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=age_over_65_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

We can observe a clear correlation, although we need to evaluate its precision.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
model <- lm(Death_rate ~ age_over_65_2019, data = clean_merged)
summary(model)
```

According to these statistics, the correlation between the percentage of people older than 65 years old and the mortality rate within a country is robust. A one-percent increase of the share of elders leads to a 0.05% increase of the mortality rate. Since the latter ranges mostly from 0 to 3, such correlation is far from being uninteresting. However, our model only explains about 13% of the mortality rate. This weak R-squared should warn us about other factors influencing the mortality rate on the county-level. First, we can try to explore a correlation with a more precise age range. Our dataset provides us with the percentage of people older than 85 years old in each county. We can run this linear model.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=age_over_85_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="red")
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
model <- lm(Death_rate ~ age_over_85_2019, data = clean_merged)
summary(model)
```

We can see that the R-squared is even smaller for such regression, at around 5%: to generalize, the percentage of habitants older than 85 years old within a county fails to explain 95% of mortality from Covid. As a final attempt to modelize the relationship between age and Covid mortality, we use the median age of each county. Such analysis is advantageous to the extent that it offers a more precise overview of the demographic makeup of each county.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=median_age_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
model <- lm(Death_rate ~ median_age_2019, data = clean_merged)
summary(model)
```

This new regression, once again, fails to explain much of the mortality rate. Furthermore, we have to reject its intercept on the 95% confidence level. Therefore, these three regressions seem to indicate age, while significant, cannot be the only factor explaining why Covid has had different levels of mortality throughout the country. This conclusion prompts us to study other factors not related to age.

### Race

It has been established by scholars that ancestry does not play a significant role regarding risks of Covid for a patient. However, race continues to play a major role in American society, characterized by a long-lasting system of racial segregation. Although legally disbanded since the 1960s, the negative effects of it are still visible today. Therefore, it is safe to suppose a greater vulnerability for some ethnic background, such as African-Americans or Latinos. By exploring the racial makeup of the counties, we can test this hypothesis.

#### Non-Hispanic Whites

Following the guidelines of the United States census Bureau, the Latinos are not considered as a separate race, but rather as an ethnicity. Therefore, most Latinos declare their race as White, and precise a Hispanic ethnicity. In the case of our study, Hispanics are considered as a distinct group. Therefore, rather than Whites, we study here the correlation between Covid mortality and the percentage of non-Hispanic Whites.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=white_not_hispanic_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
model <- lm(Death_rate ~ white_not_hispanic_2019, data = clean_merged)
summary(model)
```

The percentage of non-hispanic Whites within a county does not have any significant effect on the mortality rate. This absence of correlation is not surprising: Non-Hispanic Whites represent a majority of the American population: while by average richer than other ethnic groups, they do not form a homogeneous group. Studying other factors, such as socio-economic ones, would therefore be more relevant in this case.

#### African-Americans

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=black_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
model <- lm(Death_rate ~ black_2019, data = clean_merged)
summary(model)
```

The percentage of African-Americans within a county have a weak, yet significant effect on the risks regarding Covid. A one percent increase in the Black share of the population is expected to increase the mortality rate by 0.004%. In order to obtain a clearer view of the correlation, we can drop the counties less than 10% African-American in their population.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  filter(black_2019>10) |>
  ggplot(aes(x=black_2019, y=Death_rate))+
           geom_point()+
           geom_smooth(method = "lm", col="blue")
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
model <- lm(Death_rate ~ black_2019, data = clean_merged |> filter(black_2019 > 10))
summary(model)
```
This adjusted model confirms a positive correlation between the two variables: the more African-Americans live in a county, the more sensible to Covid this county is.
We can explore further this weak correlation by creating a new variable, `afam_class`. `afam_class` divides the counties in ten classes based on the share of African-American in their population.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged <- clean_merged |>
  mutate(afam_class = cut(black_2019,
                          breaks = seq(0, 100, 10), 
                          include.lowest = TRUE))
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=afam_class, y=Death_rate, color=afam_class))+
  geom_boxplot()
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  group_by(afam_class) |>
  summarise("Median death rate"=median(Death_rate, na.rm=TRUE),
            "Number of counties"= n())
```

This new variable furthers the study of the link between a large African-American population and an important mortality from Covid. As we can see, counties with a black population representing between 70 and 80% of its total population has a median of 1.9% of death among confirmed cases. This median is only 1.32% for counties where the black share of the population does not exceed 10%. Although the small number of counties with a large black population should warn us about the precision of these results, they still show a clear pattern of vulnerability from Covid for Black Americans.

#### Hispanics

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=hispanic_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
model <- lm(Death_rate ~ hispanic_2019, data = clean_merged)
summary(model)
```

The percentage of Latinos in a county does not have any significant effect on our studied variable.

#### Conclusion

Following this part of our study, we can conclude by putting the role of race as an explaining variable of the mortality into perspective. Intra-group differences seem to reduce the relevance of such correlation. Only the share of African-Americans play a significant role. This can be explained by the specific challenges faced by the Black community. Aware of the limited impact of race, we can now look for other explaining variables. A study of income and other economic factors would be a better fit to strengthen our model.

### Housing and location

The United States are the the third largest country in the world and include a wide variety of natural regions and communities. As of 2021, 83% of Americans were living in cities and other urban communities. One can expect a difference of mortality and infection between different types of communities, a hypothesis we can test now based on our dataset.

#### Urban and rural counties

Our dataset only provides partial data regarding the urbanization of counties. Indeed, only Medically Underserved Areas, a classification we will explain more deeply later in our study, have a specified degree of urbanization. Three of them are specified: "Rural", "Partially Rural" and "Non-Rural".

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  group_by(`Rural Status Description`) |>
  summarize("Number of counties"=n())
```

Among the 1,729 counties with data provided, a large majority are considered as rural ones by the Department of Health and Human Services. Since only Medically Underserved counties are taken into account here, this fact in itself indicates an overexposure of rural counties to public health issues.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  filter(!is.na(`Rural Status Description`)) |>
  ggplot(aes(x = Death_rate, fill = `Rural Status Description`)) +
  geom_density(alpha = 0.5)
```
Comparing the density functions of the three different status, however, seems to indicate an absence of clear difference between them. To confirm it, we can compare them with basic statistics:

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
clean_merged |>
  filter(!is.na(`Rural Status Description`)) |>
  filter(!is.na(Death_rate)) |>
  group_by(`Rural Status Description`) |>
  summarize("Number of counties"=n(),
            "Median incidence"=median(Infection_rate),
            "Median mortality"=median(Death_rate))
```

The table shown above proves the absence of clear difference between the three types of counties. Nevertheless, we can still notice a slightly higher median mortality rate in rural communities, but a smaller median infection rate. The latter can be explained by the lower rate of detection of the disease in areas less equipped with medical structures. Therefore, the absence of detection of mild symptoms of Covid might have led to a higher mortality rate among detected cases.
Overall, the difference is not large enough to suppose a clear distinction. However, this analysis is only about underserved areas, already more exposed than the rest of the country. Since most rural counties are often among the more exposed, we cannot rule out the impact of living far from a urban center on a high mortality rate from Covid, but the limits of our dataset prevent us to prove it.

#### Housing

Covid being an infectious disease transmitted through air, the accommodation can play a major role in its transmission. Overcrowded place, indeed, are places with a high risk of infection. To verify this assumption, we use two variables included in our dataset hinting towards overcrowded accommodations. The first one ,`persons_per_household_2019`, specifies the average number of people living under the same roof. The second, `housing_mobile_homes_2019`, indicates the share of mobile homes in the total number of accommodations. 

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=persons_per_household_2019, y=Infection_rate))+
  geom_rug()+
  geom_smooth(method = "lm", col="purple")
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=housing_mobile_homes_2019, y=Infection_rate))+
  geom_rug(alpha=0.5)+
  geom_smooth(method = "lm", col="purple")
```
We can observe a positive correlation between each of these variables and the infection rate, in accordance with our hypothesis. However, we do not have any reason to assume that the mortality rate is positively impacted by the number of people in each household. We can test the correlation in order to obtain a clearer idea.

```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
ggplot(clean_merged, aes(x=persons_per_household_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method = "lm", col="pink")
```
```{r}
#| echo: false
#| warning: false
#| message: false
#| results: "hide"
model <- lm(Death_rate ~ persons_per_household_2019, data = clean_merged)
summary(model)
```

As expected, the number of persons per household is not positively correlated with the mortality rate. Inversely, rather than a positive correlation, a negative one is observed: ceteris paribus, a county with an average of 3 persons per household is expected to have a mortality rate 0.27% lower than one with an average of 2. This negative correlation can be explained by a higher incidence in counties with more populated accommodations, most notably with children, lowering the share of severe cases.


## II. Analysis of Socio-Economic Data

### A - Income

To explore the relationship between economic factors and the impact of COVID-19, this analysis focuses on the variable median_household_income_2019. Median household income serves as a key indicator of the financial well-being of populations. To examine disparities, we will compare COVID-19 death and infection rates between counties in the first and tenth income quantiles, representing the lowest and highest income brackets, respectively.

To investigate the relationship between economic variables and COVID-19, we will analyze the variable ‚Äúmedian_household_income_2019.‚ÄùMedian household income provides insight into the financial well-being of different populations, to differentiate groups, we will compare the death and infection rates between the 1st and 10th income quantiles.

```{r}
#| echo: false
quantiles <- clean_merged |>
  summarise(quantile_0.1 = quantile(median_household_income_2019, probs = seq(0, 1, 0.1), na.rm = TRUE))

# Cr√©er un tableau avec les bornes d'intervalles
quantile_intervals <- data.frame(
  Decile = paste0("D", 1:10),  # D√©ciles D1 √† D10
  Boundaries = paste0("(", quantiles$quantile_0.1[-length(quantiles$quantile_0.1)], 
                      " ; ", quantiles$quantile_0.1[-1], ")")  # Associer les bornes
)

# Afficher le tableau
print(quantile_intervals)
warning = FALSE
```

The first decile comprises counties with a median household income below $38,080, representing the lowest 10% of the dataset. Conversely, the tenth decile includes counties with a median household income exceeding $70,321, corresponding to the highest 10% of the data. The following charts illustrate disparities between counties in the first and tenth income deciles with respect to COVID-19 infection and death rates. Notably, the death rate reflects the proportion of COVID-19 cases that resulted in fatalities.

```{r}
#| echo: false
result <- clean_merged |>
  summarise(
    count_sup = sum(median_household_income_2019 > 70321, na.rm = TRUE),
    count_inf_or_equal = sum(median_household_income_2019 <= 38080 , na.rm = TRUE),
    total_count = n()
  )

print(result)
```


```{r}
#| echo: false
filtered_data <- clean_merged |>
  filter(
    (median_household_income_2019 < 38800 | median_household_income_2019 > 70321) & 
    Infection_rate < 50
  ) |>
  mutate(
    income_category = case_when(
      median_household_income_2019 < 38800 ~ "Revenu < 38800",
      median_household_income_2019 > 70321 ~ "Revenu > 70321"
    )
  )

```

```{r}
#| echo: false
# Summarizing the data by income category for both infection and death rates
summary_stats <- filtered_data |>
  group_by(income_category) |>
  summarise(
    # Infection Rate Statistics
    mean_infection_rate = mean(Infection_rate, na.rm = TRUE),
    sd_infection_rate = sd(Infection_rate, na.rm = TRUE),
    n_infection = n(),
    lower_ci_infection = mean_infection_rate - qt(0.975, df = n_infection - 1) * (sd_infection_rate / sqrt(n_infection)),
    upper_ci_infection = mean_infection_rate + qt(0.975, df = n_infection - 1) * (sd_infection_rate / sqrt(n_infection)),
    
    # Death Rate Statistics
    mean_death_rate = mean(Death_rate, na.rm = TRUE),
    sd_death_rate = sd(Death_rate, na.rm = TRUE),
    n_death = n(),
    lower_ci_death = mean_death_rate - qt(0.975, df = n_death - 1) * (sd_death_rate / sqrt(n_death)),
    upper_ci_death = mean_death_rate + qt(0.975, df = n_death - 1) * (sd_death_rate / sqrt(n_death))
  )
```

```{r}
#| echo: false
ggplot(filtered_data, aes(x = income_category, y = Infection_rate, fill = income_category)) +
  geom_boxplot() +
  labs(
   title = "Infection Rate by Income Category",
   x = "Income Category",
   y = "Infection Rate"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5)  # Titre centr√© et en gras
  )+
  scale_fill_manual(values = c("Income < X" = "blue", "Income > Y" = "red"))
```

```{r}
#| echo: false
ggplot(filtered_data, aes(x = median_household_income_2019, y = Infection_rate, color = income_category)) +
  geom_point(size = 3, alpha = 0.4) +  # Nuage de points
  labs(
    title = "Infection Rate by Income Category",
    x = "Income Category",
    y = "Infection Rate"
  ) +
  scale_color_manual(
    values = c("Revenu < 38800" = "blue", "Revenu > 70321" = "red")
  ) +  # Couleurs personnalis√©es
  theme_minimal() +
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5)  # Titre centr√© et en gras
  )
```
Both Graphs illustrate Infection rates between the first and last decile. It shows no striking differences ( mean 32% vs 28,7% )

```{r}
#| echo: false
ggplot(filtered_data, aes(x = median_household_income_2019, y = Death_rate, color = income_category)) +
  geom_point(size = 3, alpha = 0.4) +  # Nuage de points
  labs(
    title = "Death Rate by Income Category",
    x = "Income Category",
    y = "Death Rate"
  ) +
  scale_color_manual(
    values = c("Revenu < 38800" = "blue", "Revenu > 70321" = "red")
  ) +  # Couleurs personnalis√©es
  theme_minimal() +
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5)  # Titre centr√© et en gras
  )
```

```{r}
#| echo: false
ggplot(filtered_data, aes(x = income_category, y = Death_rate, fill = income_category)) + 
  geom_boxplot() + 
  labs(
    title = "Death Rate by Income Category",
    x = "Income Category",
    y = "Death Rate"
  ) + 
  theme_minimal() + 
  theme(
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5)  # Titre centr√© et en gras
  )+
  scale_fill_manual(values = c("Revenu < 38800" = "blue", "Revenu > 70321" = "red"))
```

The data reveal substantial disparities in infection and mortality rates across income categories. Households with low incomes (less than $38,880) experience a mean infection rate of 32.08%, which is notably higher than the 28.68% observed among high-income households (earning more than $70,321). The associated confidence intervals (31.35% to 32.82% for low-income households and 27.89% to 29.47% for high-income households) confirm the statistical reliability of these estimates, although the difference in infection rates is relatively moderate.

In contrast, the disparity in mortality rates is more pronounced. Low-income households report a mean mortality rate of 1.83%, nearly twice that of high-income households, which stands at 0.88%. This significant gap is reinforced by non-overlapping confidence intervals (1.75% to 1.90% for low-income households and 0.84% to 0.92% for high-income households), highlighting the critical impact of economic inequality on severe health outcomes.

These findings underscore the pivotal role of social determinants in shaping pandemic outcomes. While poverty itself may not exert a direct influence, its downstream effects‚Äîsuch as limited health insurance coverage, economic instability, and restricted access to essential resources‚Äîplay a decisive role in exacerbating health disparities during crises. To deepen this analysis, we will investigate health insurance coverage, with a particular focus on uninsured populations, including vulnerable groups such as the elderly, to assess the impact of gaps in the U.S. healthcare system on the management of critical cases.



### B - Insurance

One of the direct consequences of income inequality is the disparity in access to healthcare coverage, which is often closely tied to financial resources. Given that individuals aged 65 and older account for the majority of COVID-19-related deaths, this analysis will focus specifically on this demographic group.

```{r}
#| echo: false
uninsurance <- clean_merged |>
  summarise(mean_uninsured_over_65 = mean(uninsured_65_and_older_2019, na.rm = TRUE))  # Calculate mean while ignoring NAs

print(uninsurance)
```

```{r}
#| echo: false
model <- lm(Death_rate ~ uninsured_65_and_older_2019 , data =clean_merged)
summary(model)
```
The insurance coverage rate among individuals aged 65 and older exceeds 99.5%, largely due to Medicare eligibility, which supplements or replaces private insurance. Regression analysis shows no significant relationship between the proportion of uninsured seniors and COVID-19 mortality rates (p-value: 0.5687; R-squared: ~0), suggesting that uninsurance does not directly impact mortality outcomes. While exploring differences by insurance type would be valuable, the dataset lacks the granularity needed for such an analysis.



### C - Poverty

Having analyzed health insurance coverage among individuals aged 65 and older, we now turn our focus to examining poverty within the same demographic. The study of poverty in this age group is particularly relevant as it provides critical insights into economic vulnerability and its potential impact on health outcomes. Poverty among seniors can influence access to resources, quality of living conditions, and overall well-being, all of which play a significant role in shaping resilience to health crises such as the COVID-19 pandemic. Understanding these dynamics is essential for addressing disparities and improving outcomes in this vulnerable population.

```{r}
#| echo: false
clean_poverty_65_and_over_2019 <- clean_merged |>
  filter(!is.na(poverty_65_and_over_2019) & (Death_rate < 2.5 ))  # Remove rows with NA values in the column

print(clean_poverty_65_and_over_2019)
```

```{r}
#| echo: false
# Add a "decile" variable to the clean_merged dataset
clean_poverty_65_and_over_2019 <- clean_poverty_65_and_over_2019|>
  mutate(
    decile = cut(
      poverty_65_and_over_2019,
      breaks = quantile(poverty_65_and_over_2019, probs = seq(0, 1, 0.1), na.rm = TRUE),
      include.lowest = TRUE,
      labels = 1:10
    )
  )

summary_by_decile <- clean_poverty_65_and_over_2019 |>
  group_by(decile) |>
  summarise(
    avg_death_rate = mean(Death_rate, na.rm = TRUE),
    median_death_rate = median(Death_rate, na.rm = TRUE),
    median_poverty_rate = median(poverty_65_and_over_2019, na.rm = TRUE),
    avg_poverty_rate = mean(poverty_65_and_over_2019, na.rm = TRUE)
  )

# Print the summary table
print(summary_by_decile)
""
```
```{r}
#| echo: false
ggplot(summary_by_decile, aes(x = median_poverty_rate, y = median_death_rate)) +
  geom_point(color = "blue", size = 3) +  # Add points to the scatter plot
  geom_smooth(method = "lm", color = "red", se = TRUE) +  # Add regression line with confidence interval
  geom_line(color = "blue", linetype = "dashed") +  # Connect the points with lines
  labs(
    title = "Relationship Between Median Poverty Rate and Median Death Rate",
    x = "Median Poverty Rate (%)",
    y = "Median Death Rate (%)"
  ) +
  theme_minimal() +
  theme(
    text = element_text(size = 13),
    axis.title = element_text(size = 13),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )
```
This graph represents the median death rate in function of the median poverty rate, each blue point represents a decile. The red lign illustrate the linear regression line, while the grey shadow is the confidence interval. It depicts a correlation, the higher the poverty rate, the higher the death rate.


```{r}
#| echo: false
model <- lm(median_death_rate ~ median_poverty_rate , data = summary_by_decile)
summary(model)
```

The analysis reveals a stark correlation between poverty and COVID-19 mortality. A 1% increase in the median poverty rate corresponds to a 0.05% rise in the death rate. With an R¬≤ of 89.65%, poverty explains most variability in mortality, underscoring the devastating impact of socioeconomic inequalities during health crises.



### D - Information capacity

Aggregate_connectivity quantifies household digital access by averaging three key components: broadband, smartphone, and computer availability in 2019. The index ranges from 0.33 to 0.94 (indicating near-complete connectivity), excluding missing values. This measure provides a valuable tool for examining digital inclusion and its broader socioeconomic implications with precision and clarity.

```{r}
#| echo: false
quantiles2_prefilter  <- clean_merged  |>
   filter(Aggregate_connectivity > 0)
```
```{r}
#| echo: false
quantiles2 <- quantiles2_prefilter  |>
   summarise(quantile_0.1 = quantile(Aggregate_connectivity, probs = seq(0, 1, 0.1), na.rm = TRUE))
```

```{r}
#| echo: false
quantiles2_filtered <- clean_merged |>
  filter(
    (Aggregate_connectivity <= 62.09333 & Aggregate_connectivity > 33.83333) |
    Aggregate_connectivity > 83.20000
  ) |>
  mutate(
    Connectivity_index = case_when(
      Aggregate_connectivity <= 62.09333 & Aggregate_connectivity > 33.83333 ~ "33.8% < Aggregate_connectivity < 62%",
      Aggregate_connectivity > 83.20000 ~ "Aggregate_connectivity > 83.2%"
    )
  )

```

```{r}
#| echo: false
ggplot(quantiles2_filtered, aes(x = Connectivity_index, y = Death_rate, fill = Connectivity_index)) +
  geom_violin(trim = FALSE, alpha = 0.7) +  # Violin plot
  geom_boxplot(width = 0.1, alpha = 0.8, outlier.shape = NA) +  # Overlay boxplot for detail
  labs(
    title = "Death Rate Distribution by Connectivity Category",
    x = "Connectivity Category",
    y = "Death Rate"
  ) +
  scale_fill_manual(
    values = c(
      "33.8% < Aggregate_connectivity < 62%" = "blue",
      "Aggregate_connectivity > 83.2%" = "red"
    )
  ) +
  theme_minimal() +
  theme(

    plot.title = element_text(size = 13, face = "bold", hjust = 0.5)
  )
```
This chart shows Death rates differences in function of connetivity. It shows highly connected counties are less impacted than the least ones.

```{r}
#| echo: false
ggplot(quantiles2_prefilter, aes(x = Aggregate_connectivity, y = Death_rate)) +
  geom_point(alpha = 0.4, size = 1.5, color = "darkblue") +
  geom_smooth(method = "lm", color = "red", se = TRUE, linetype = "dashed") +  # Ajoute une droite de r√©gression
  labs(
    title = "Scatter Plot: Connectivity and Death Rate",
    subtitle = "Linear regression line added to highlight correlation",
    x = "Aggregate Connectivity (%)",
    y = "Death Rate (%)"
  ) +
  coord_cartesian(xlim = c(50, 85), ylim = c(0.5, 4)) +  # Ajuste les limites des axes
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),  # Style du titre
    plot.subtitle = element_text(size = 14, hjust = 0.5),  # Style du sous-titre
    legend.position = "right",  # Position de la l√©gende
    panel.grid.minor = element_blank()  # Supprime les grilles mineures
  )
```
```{r}
#| echo: false
# Summarizing the data by connectivity category for infection and death rates
summary_stats_connectivity <- quantiles2_filtered |>
  group_by(Connectivity_index) |>
  summarise(
    # Infection Rate Statistics
    mean_infection_rate = mean(Infection_rate, na.rm = TRUE),
    sd_infection_rate = sd(Infection_rate, na.rm = TRUE),
    n_infection = n(),
    lower_ci_infection = mean_infection_rate - qt(0.975, df = n_infection - 1) * (sd_infection_rate / sqrt(n_infection)),
    upper_ci_infection = mean_infection_rate + qt(0.975, df = n_infection - 1) * (sd_infection_rate / sqrt(n_infection)),

    # Death Rate Statistics
    mean_death_rate = mean(Death_rate, na.rm = TRUE),
    sd_death_rate = sd(Death_rate, na.rm = TRUE),
    n_death = n(),
    lower_ci_death = mean_death_rate - qt(0.975, df = n_death - 1) * (sd_death_rate / sqrt(n_death)),
    upper_ci_death = mean_death_rate + qt(0.975, df = n_death - 1) * (sd_death_rate / sqrt(n_death))
  )

```

```{r}
#| echo: false
model <- lm(Death_rate ~ Aggregate_connectivity , data = quantiles2_filtered)
summary(model)
```


This analysis highlights the profound impact of connectivity on mortality during the pandemic. Low-connectivity areas (below 62%) experienced a mean death rate of 31.96%, significantly higher than the 28.51% observed in high-connectivity areas (above 83.2%). Each percentage point increase in connectivity reduces death rates by 0.0328%, explaining 45% of mortality variation. It can be explained by various factors : the is certainly a correlation between average age and connectivity as aged people own less digital products than younger ones. digital products are costly, so generally poor people have less electronical devices than rich ones, and poor people have generally higher obesity, chronical diseases which play an important role in COVID-19 mortality
Moreover, strong connectivity also supports remote working, reducing exposure risks and enhancing resilience. 


## III. Health System

### A - Healthcare Access Disparities: Medically Underserved Counties Compared to Others

Analyzing disparities between medically underserved and other counties highlights healthcare inequalities, revealing critical gaps in resources, access, and outcomes.


```{r}
#| echo: false
# Summarizing the data by income category for both infection and death rates
clean_underserved <- clean_merged |>
  group_by(medically_underserved_dummy) |>
  filter( Death_rate > 0 & Infection_rate > 0) |>
  summarise(
    # Infection Rate Statistics
    mean_infection_rate2 = mean(Infection_rate, na.rm = TRUE),
    sd_infection_rate2 = sd(Infection_rate, na.rm = TRUE),
    n_infection2 = n(),
    lower_ci_infection2 = mean_infection_rate2 - qt(0.975, df = n_infection2 - 1) * (sd_infection_rate2 / sqrt(n_infection2)),
    upper_ci_infection2 = mean_infection_rate2 + qt(0.975, df = n_infection2 - 1) * (sd_infection_rate2 / sqrt(n_infection2)),
    
    # Death Rate Statistics
    mean_death_rate2 = mean(Death_rate, na.rm = TRUE),
    sd_death_rate2 = sd(Death_rate, na.rm = TRUE),
    n_death2 = n(),
    lower_ci_death2 = mean_death_rate2 - qt(0.975, df = n_death2 - 1) * (sd_death_rate2 / sqrt(n_death2)),
    upper_ci_death2 = mean_death_rate2 + qt(0.975, df = n_death2 - 1) * (sd_death_rate2 / sqrt(n_death2))
  )

# Print summary statistics
print(clean_underserved)
```
The data reveal that medically underserved counties have higher mean infection rates (31.69%) and death rates (1.68%) compared to non-underserved counties (30.26% and 1.36%, respectively). These findings highlight an impact of the pandemic on underserved areas, emphasizing the need to address healthcare access disparities.
```{r}
#| echo: false
ggplot(clean_merged, aes(x = factor(medically_underserved_dummy), y = Death_rate)) +
  geom_boxplot(fill = "lightblue", alpha = 0.3, outlier.size = 2) +  # Use boxplot for clear distribution
  labs(
    title = "Death Rate by Medical Underserved Area Category",
    x = "Medical Underserved (0 = No, 1 = Yes)",
    y = "Death Rate (%)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),  # Improve title style
    axis.title = element_text(size = 14),  # Better axis titles
    axis.text = element_text(size = 12)  # Improve axis text readability
  ) +
  scale_x_discrete(labels = c("Not Underserved", "Underserved"))  # Add meaningful labels for categories 
```
The difference in death rates between non-underserved counties (1.35%) and medically underserved counties (1.67%) is 0.32 percentage points, representing a 23.7% higher death rate in underserved areas. This emphasizes the significant impact of healthcare disparities on COVID-19 mortality outcomes.

```{r}
model <- lm(Death_rate ~ medically_underserved_dummy , data = clean_merged)
summary(model)
```

### B - Number of providers
"

```{r}
#| echo: false
clean_providers <- clean_merged |>
  filter(Death_rate > 0 & Infection_rate > 0 & !is.na(`Providers per 1000 Population`) & `Providers per 1000 Population` > 0 )  # Ensures no NA values in the column

ggplot(clean_providers, aes(x = `Providers per 1000 Population`, y = Death_rate)) +
  geom_point(alpha = 0.7, color = "blue") +  # Add transparency and color for better visualization
  labs(
    title = "Relationship Between Providers per 1000 Population and Death Rate",
    x = "Providers per 1000 Population",
    y = "Death Rate (%)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12)
  )
```

The scatterplot demonstrates no clear correlation between the number of providers per 1000 population and the death rate. The data points are widely dispersed, and there is no discernible trend or pattern to indicate a strong or consistent relationship between these two variables.

The tests conducted in this study reveal no evidence of a correlation between medical coverage and COVID-19 mortality. However, the absence of evidence does not necessarily imply that no relationship exists. One critical factor to consider is the shortage of medical personnel, which likely played a significant role during the first wave of the pandemic, when healthcare systems were overwhelmed. It is important to note that the data used in this analysis extends only up to 2022, a period significantly removed from the initial wave. Consequently, it would be valuable to replicate this analysis using data specifically from the first wave to better understand the potential relationship between medical coverage and mortality during the most critical phase of the pandemic.
