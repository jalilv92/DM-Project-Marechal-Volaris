---
title: "Data Management final project Maréchal-Volaris"
format: pdf
editor: visual
---


```{r}
here::i_am("DM-Project-Marechal-Volaris.Rproj")
library(here)
library(vroom)
clean_merged <- vroom("clean_merged.csv")
library(dplyr)
library(tidyr)
library(ggplot2)
```

# 1. Presentation of the Research Question

Cleaning and merging the datasets allows us to obtain a clearer view of the question we are aiming to answer to: to what extent socio-economical factors have influenced the impact of the Covid-19 pandemic throughout the United States? Although Covid has been a global issue, it is fair to state that the United States were among the most impacted countries: according to the Centers for Disease Control and Prevention, almost 1.2 millions Americans have died of Covid-related complications, the most of any country worldwide. Once we take into account the overall populations, indicators are still concerning and should prompt us to try to understand better what can explain them. For example, the mortality rate (the ratio between total death and total cases reported) is equal to 1.17%, whereas it is only 0.43% in France. Such difference is explained thanks to various socio-economical factors, as well as political decisions. For example, the American healthcare system, relying on private companies rather than a mandatory public option, has been criticized for its negative impact on overall public health. Studying how uninsured Americans have been affected by the pandemic would therefore helps us understand if the weaknesses of the healthcare system played a role in an increased mortality rate. In addition to this first approach, our datasets allow us to study in a deeper way how economical and social differences may have played a role in how the mortality rate has evolved in various regions. The `counties` dataset, for example, provides us with a full racial make-up of each county-equivalent in the country, as well as basic economic indicators, such as the median income or the unemployment rate. To answer to our research question, we have chosen to base our study on the county-level, in order to get a more precise view of the country, which would not have been possible on the state-level.

# 2. Understanding Data

## 1. Dataset Descritption

## A - Dataset

To pursue our study, we need to establish per capita variables. Indeed, counties have widely varying populations.

```{r}
#| echo: false
clean_merged |>
  group_by(name) |>
  select(name, state, pop_2019) |>
  summarize(state=state,
            population=pop_2019) |>
  arrange(population)
```

```{r}
#| echo: false
clean_merged |>
  group_by(name) |>
  select(name, state, pop_2019) |>
  summarize(state=state,
            population=pop_2019) |>
  arrange(-population)
```

As we can see, in 2019, a county population ranges from 66 (Kalawao County, Hawaii) to more than 10 millions habitants (Los Angeles County, California). Aware of this disparity, we establish two per capita variables: the infection rate and the mortality rate. They are defined as: Infection rate=Total of confirmed cases/Total county population Mortality rate=Total death from Covid 19/Total of confirmed cases For a better understanding, we express these rates as percentages by multiplying them by 100.

```{r}
#| echo: false
clean_merged <- clean_merged |>
  mutate(Death_rate = ifelse(`Total Confirmed` > 0, (`Total Death` / `Total Confirmed`) * 100, NA)) |>
  mutate(Infection_rate = ifelse( pop_2019 > 0, (`Total Confirmed` / pop_2019) * 100, NA)) |>
  mutate( medically_underserved_dummy = ifelse(
      !is.na(`Designation Population in a Medically Underserved Area/Population (MUA/P)`) |
      !is.na(`Medically Underserved Area/Population (MUA/P) Total Resident Civilian Population` ) |
      !is.na(`Providers per 1000 Population`), 
      1, 
      0
    )
  )
```

```{r}
clean_merged |>
  group_by(fips) |>
  select(name, Infection_rate) |>
  summarise(Infection_rate,
            name) |>
  arrange(-Infection_rate)
```

```{r}
#| echo: false
clean_merged |>
  group_by(fips) |>
  select(name, Death_rate) |>
  summarise(Death_rate,
            name) |>
  arrange(-Death_rate)
```

We notice that two county-equivalents have infection rate higher than 100%. This abnormality can be explained by various reasons, such as an error in the database, a decline in population, a center diagnosing cases from neighboring counties, ... For the sake of our study, we can drop these outliers.

```{r}
clean_merged <- clean_merged |>
  filter(Infection_rate<100)
```

In order to understand these two variables better, we represent them graphically. As continuous variables, a density function seems to be the best way to do so.

```{r}
#| echo: false
ggplot(clean_merged, aes(x=Infection_rate))+
  geom_density()
```

```{r}
clean_merged |>
  pull(Infection_rate) |>
  quantile(probs=seq(0, 1, by=0.1), na.rm=TRUE)
```

Covid has a heterogeneous impact on the United States, with 80% of counties having an infection rate ranging from 22.45% to 38.46%.

```{r}
#| echo: false
ggplot(clean_merged, aes(x=Death_rate))+
  geom_density()
```

We can notice that both rates are distributed following a roughly normal law, centered around 30% for `Infection_rate` and a 1.2% for `Death-rate`. The disparities observed are significant, some counties having a death rate superior to 4%. These disparities are clearly shown by the quantiles of the `Death_rate` variable.

```{r}
clean_merged |>
  pull(Death_rate) |>
  quantile(probs=seq(0, 1, by=0.1), na.rm=TRUE)
```

Here, we can notice a clear difference between quantiles: the two extremes are 0.73% and 2.2%. Therefore, we can ask ourselves what can explain such differences between counties.

# 3. Data Analysis and Interpretation

## I. Analysis of Demographic Data

### Age

It is safe to state that the age is among the most important factors explaining Covid-19 mortality. Older people represent a majority of fatalities from the disease and are more sensible to its symptoms. Our dataset provides us with various variables regarding age. We can first test how the percentage of people older than 65 years old impact the death rate within a county.

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(clean_merged, aes(x=age_over_65_2019))+
  geom_density()
```

Most counties have an elder population representing between 10 and 30% of its citizens. As a numeric continuous variable, we can establish classes in order to obtain an overview of the variable and its correlation with the death rate from Covid.

```{r}
#| echo: false
clean_merged |>
  mutate(elder_class = cut(age_over_65_2019,
                          breaks = seq(0, 100, 5), 
                          include.lowest = TRUE)) |>
  ggplot(aes(y=elder_class, x=Death_rate, fill=elder_class))+
  geom_violin()
```

The graph seems to indicate a positive correlation between the two variables: the higher the population over 65 years old, the higher the mortality from Covid. This hypothesis prompts us to test a linear regression model involving the two variables.

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(clean_merged, aes(x=age_over_65_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

We can observe a clear correlation, although we need to evaluate its precision.

```{r}
#| echo: false
#| message: false
#| warning: false
model <- lm(Death_rate ~ age_over_65_2019, data = clean_merged)
summary(model)
```

According to these statistics, the correlation between the percentage of people older than 65 years old and the mortality rate within a country is robust. A one-percent increase of the share of elders leads to a 0.05% increase of the mortality rate. Since the latter ranges mostly from 0 to 3, such correlation is far from being uninteresting. However, our model only explains about 13% of the mortality rate. This weak R-squared should warn us about other factors influencing the mortality rate on the county-level. First, we can try to explore a correlation with a more precise age range. Our dataset provides us with the percentage of people older than 85 years old in each county. We can run this linear model.

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(clean_merged, aes(x=age_over_85_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="red")
```

```{r}
#| echo: false
#| message: false
#| warning: false
model <- lm(Death_rate ~ age_over_85_2019, data = clean_merged)
summary(model)
```

We can see that the R-squared is even smaller for such regression, at around 5%: to generalize, the percentage of habitants older than 85 years old within a county fails to explain 95% of mortality from Covid. As a final attempt to modelize the relationship between age and Covid mortality, we use the median age of each county. Such analysis is advantageous to the extent that it offers a more precise overview of the demographic makeup of each county.

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(clean_merged, aes(x=median_age_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

```{r}
#| echo: false
#| message: false
#| warning: false
model <- lm(Death_rate ~ median_age_2019, data = clean_merged)
summary(model)
```

This new regression, once again, fails to explain much of the mortality rate. Furthermore, we have to reject its intercept on the 95% confidence level. Therefore, these three regressions seem to indicate age, while significant, cannot be the only factor explaining why Covid has had different levels of mortality throughout the country. This conclusion prompts us to study other factors not related to age.

### Race

It has been established by scholars that ancestry does not play a significant role regarding risks of Covid for a patient. However, race continues to play a major role in American society, characterized by a long-lasting system of racial segregation. Although legally disbanded since the 1960s, the negative effects of it are still visible today. Therefore, it is safe to suppose a greater vulnerability for some ethnic background, such as African-Americans or Latinos. By exploring the racial makeup of the counties, we can test this hypothesis.

#### Non-Hispanic Whites

Following the guidelines of the United States census Bureau, the Latinos are not considered as a separate race, but rather as an ethnicity. Therefore, most Latinos declare their race as White, and precise a Hispanic ethnicity. In the case of our study, Hispanics are considered as a distinct group. Therefore, rather than Whites, we study here the correlation between Covid mortality and the percentage of non-Hispanic Whites.

```{r}
#| echo: false
ggplot(clean_merged, aes(x=white_not_hispanic_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

```{r}
#| echo: false
#| message: false
#| warning: false
model <- lm(Death_rate ~ white_not_hispanic_2019, data = clean_merged)
summary(model)
```

The percentage of non-hispanic Whites within a county does not have any significant effect on the mortality rate. This absence of correlation is not surprising: Non-Hispanic Whites represent a majority of the American population: while by average richer than other ethnic groups, they do not form a homogeneous group. Studying other factors, such as socio-economic ones, would therefore be more relevant in this case.

#### African-Americans

```{r}
#| echo: false
ggplot(clean_merged, aes(x=black_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

```{r}
#| echo: false
#| message: false
#| warning: false
model <- lm(Death_rate ~ black_2019, data = clean_merged)
summary(model)
```

The percentage of African-Americans within a county have a weak, yet significant effect on the risks regarding Covid. A one percent increase in the Black share of the population is expected to increase the mortality rate by 0.004%. In order to obtain a clearer view of the correlation, we can drop the counties less than 10% African-American in their population.

```{r}
clean_merged |>
  filter(black_2019>10) |>
  ggplot(aes(x=black_2019, y=Death_rate))+
           geom_point()+
           geom_smooth(method = "lm", col="blue")
```
```{r}
model <- lm(Death_rate ~ black_2019, data = clean_merged |> filter(black_2019 > 10))
summary(model)
```
This adjusted model confirms a positive correlation between the two variables: the more African-Americans live in a county, the more sensible to Covid this county is.
We can explore further this weak correlation by creating a new variable, `afam_class`. `afam_class` divides the counties in ten classes based on the share of African-American in their population.

```{r}
#| echo: false
clean_merged <- clean_merged |>
  mutate(afam_class = cut(black_2019,
                          breaks = seq(0, 100, 10), 
                          include.lowest = TRUE))
```

```{r}
#| echo: false
ggplot(clean_merged, aes(x=afam_class, y=Death_rate, color=afam_class))+
  geom_boxplot()
```

```{r}
clean_merged |>
  group_by(afam_class) |>
  summarise("Median death rate"=median(Death_rate, na.rm=TRUE),
            "Number of counties"= n())
```

This new variable furthers the study of the link between a large African-American population and an important mortality from Covid. As we can see, counties with a black population representing between 70 and 80% of its total population has a median of 1.9% of death among confirmed cases. This median is only 1.32% for counties where the black share of the population does not exceed 10%. Although the small number of counties with a large black population should warn us about the precision of these results, they still show a clear pattern of vulnerability from Covid for Black Americans.

#### Hispanics

```{r}
#| echo: false
ggplot(clean_merged, aes(x=hispanic_2019, y=Death_rate))+
  geom_point(alpha=0.5)+
  geom_smooth(method="lm", col="blue")
```

```{r}
model <- lm(Death_rate ~ hispanic_2019, data = clean_merged)
summary(model)
```

The percentage of Latinos in a county does not have any significant effect on our studied variable.

#### Conclusion

Following this part of our study, we can conclude by putting the role of race as an explaining variable of the mortality into perspective. Intra-group differences seem to reduce the relevance of such correlation. Only the share of African-Americans play a significant role. This can be explained by the specific challenges faced by the Black community. Aware of the limited impact of race, we can now look for other explaining variables. A study of income and other economic factors would be a better fit to strengthen our model.

### Housing and location

The United States are the the third largest country in the world and include a wide variety of natural regions and communities. As of 2021, 83% of Americans were living in cities and other urban communities. One can expect a difference of mortality and infection between different types of communities, a hypothesis we can test now based on our dataset.

#### Urban and rural counties

Our dataset only provides partial data regarding the urbanization of counties. Indeed, only Medically Underserved Areas, a classification we will explain more deeply later in our study, have a specified degree of urbanization. Three of them are specified: "Rural", "Partially Rural" and "Non-Rural".

```{r}
clean_merged |>
  group_by(`Rural Status Description`) |>
  summarize("Number of counties"=n())
```

Among the 1,729 counties with data provided, a large majority are considered as rural ones by the Department of Health and Human Services. Since only Medically Underserved counties are taken into account here, this fact in itself indicates an overexposure of rural counties to public health issues.

```{r}
clean_merged |>
  filter(!is.na(`Rural Status Description`)) |>
  ggplot(aes(x = Death_rate, fill = `Rural Status Description`)) +
  geom_density(alpha = 0.5)
```
Comparing the density functions of the three different status, however, seems to indicate an absence of clear difference between them. To confirm it, we can compare them with basic statistics:

```{r}
clean_merged |>
  filter(!is.na(`Rural Status Description`)) |>
  filter(!is.na(Death_rate)) |>
  group_by(`Rural Status Description`) |>
  summarize("Number of counties"=n(),
            "Median incidence"=median(Infection_rate),
            "Median mortality"=median(Death_rate))
```

The table shown above proves the absence of clear difference between the three types of counties. Nevertheless, we can still notice a slightly higher median mortality rate in rural communities, but a smaller median infection rate. The latter can be explained by the lower rate of detection of the disease in areas less equipped with medical structures. Therefore, the absence of detection of mild symptoms of Covid might have led to a higher mortality rate among detected cases.
Overall, the difference is not large enough to suppose a clear distinction. However, this analysis is only about underserved areas, already more exposed than the rest of the country. Since most rural counties are often among the more exposed, we cannot rule out the impact of living far from a urban center on a high mortality rate from Covid, but the limits of our dataset prevent us to prove it.

#### Housing

Covid being an infectious disease transmitted through air, the accommodation can play a major role in its transmission. Overcrowded place, indeed, are places with a high risk of infection. To verify this assumption, we use two variables included in our dataset hinting towards overcrowded accommodations. The first one ,`avg_family_size`, specifies the average number of people living under the same roof. The second, `housing_mobile_homes_2019`, indicates the share of mobile homes in the total number of accommodations. 

```{r}
ggplot(clean_merged, aes(x=avg_family_size_2019, y=Infection_rate))+
  geom_rug()+
  geom_smooth(method = "lm", col="purple")
```

```{r}
ggplot(clean_merged, aes(x=housing_mobile_homes_2019, y=Infection_rate))+
  geom_rug(alpha=0.5)+
  geom_smooth(method = "lm", col="purple")
```



## II. Analysis of Socio-Economic Data

### A - Introductory Comment

Socio-economic factors are integral to understanding the disparities in health outcomes and mortality rates during the COVID-19 pandemic. Variables such as income, education level, health insurance coverage, and unemployment play a significant role in shaping individuals’ access to healthcare, their ability to adhere to public health measures, and their overall vulnerability to the virus. This section is pertinent because it examines how socio-economic inequalities have amplified the pandemic’s impact, particularly among marginalized populations. For example, lower income levels may limit access to essential healthcare services, while education levels can influence the understanding and adoption of protective behaviors. Health insurance coverage, or lack thereof, is especially critical in the U.S. healthcare system, where uninsured individuals often face barriers to timely and adequate treatment. By analyzing these factors, this section contributes to a comprehensive understanding of the socio-economic dimensions of the pandemic, complementing the demographic and infrastructural analyses.

### B - Income and Poverty

Income and poverty are critical determinants of health outcomes, influencing access to healthcare, nutrition, and living conditions. This subpart examines their role in shaping disparities in COVID-19 mortality and vulnerability across different socio-economic groups.

To investigate the relationship between economic variables and COVID-19, we will analyze the variable “median_household_income_2019.”Median household income provides insight into the financial well-being of different populations, to differentiate groups, we will compare the death and infection rates between the 1st and 10th income quantiles.

```{r}
quantiles <- clean_merged  |>
   summarise(quantile_0.1 = quantile( median_household_income_2019, probs = seq(0, 1, 0.1), na.rm = TRUE))
print(quantiles)
```

The first quantile consists of counties with a median household income below \$38,080, representing the lowest 10% of the dataset. In contrast, the tenth (or last) quantile includes counties with a median household income exceeding \$70,321, representing the highest 10% of the data.

```{r}
result <- clean_merged |>
  summarise(
    count_sup = sum(median_household_income_2019 > 70321, na.rm = TRUE),
    count_inf_or_equal = sum(median_household_income_2019 <= 38080 , na.rm = TRUE),
    total_count = n()
  )

print(result)
```

filtrage

```{r}
filtered_data <- clean_merged |>
  filter(
    (median_household_income_2019 < 38800 | median_household_income_2019 > 70321) & 
    Infection_rate < 50
  ) |>
  mutate(
    income_category = case_when(
      median_household_income_2019 < 38800 ~ "Revenu < 38800",
      median_household_income_2019 > 70321 ~ "Revenu > 70321"
    )
  )

```

```{r}
# Summarizing the data by income category for both infection and death rates
summary_stats <- filtered_data |>
  group_by(income_category) |>
  summarise(
    # Infection Rate Statistics
    mean_infection_rate = mean(Infection_rate, na.rm = TRUE),
    sd_infection_rate = sd(Infection_rate, na.rm = TRUE),
    n_infection = n(),
    lower_ci_infection = mean_infection_rate - qt(0.975, df = n_infection - 1) * (sd_infection_rate / sqrt(n_infection)),
    upper_ci_infection = mean_infection_rate + qt(0.975, df = n_infection - 1) * (sd_infection_rate / sqrt(n_infection)),
    
    # Death Rate Statistics
    mean_death_rate = mean(Death_rate, na.rm = TRUE),
    sd_death_rate = sd(Death_rate, na.rm = TRUE),
    n_death = n(),
    lower_ci_death = mean_death_rate - qt(0.975, df = n_death - 1) * (sd_death_rate / sqrt(n_death)),
    upper_ci_death = mean_death_rate + qt(0.975, df = n_death - 1) * (sd_death_rate / sqrt(n_death))
  )

# Print summary statistics
print(summary_stats)
```

```{r}
ggplot(filtered_data, aes(x = income_category, y = Infection_rate, fill = income_category)) +
  geom_boxplot() +
  labs(
   title = "Infection Rate by Income Category",
   x = "Income Category",
   y = "Infection Rate"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("Income < X" = "blue", "Income > Y" = "red"))
```

```{r}
ggplot(filtered_data, aes(x = median_household_income_2019, y = Infection_rate, color = income_category)) +
  geom_point(size = 3, alpha = 0.4) +  # Nuage de points
  labs(
    title = "Infection Rate by Income Category",
    x = "Income Category",
    y = "Infection Rate"
  ) +
  scale_color_manual(
    values = c("Revenu < 38800" = "blue", "Revenu > 70321" = "red")
  ) +  # Couleurs personnalisées
  theme_minimal() +
  theme(
    text = element_text(size = 14),  # Taille du texte
    axis.title = element_text(size = 16),  # Taille des titres des axes
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5)  # Titre centré et en gras
  )
```

```{r}
ggplot(filtered_data, aes(x = median_household_income_2019, y = Death_rate, color = income_category)) +
  geom_point(size = 3, alpha = 0.4) +  # Nuage de points
  labs(
    title = "Death Rate by Income Category",
    x = "Income Category",
    y = "Death Rate"
  ) +
  scale_color_manual(
    values = c("Revenu < 38800" = "blue", "Revenu > 70321" = "red")
  ) +  # Couleurs personnalisées
  theme_minimal() +
  theme(
    text = element_text(size = 14),  # Taille du texte
    axis.title = element_text(size = 16),  # Taille des titres des axes
    plot.title = element_text(size = 18, face = "bold", hjust = 0.5)  # Titre centré et en gras
  )
```

```{r}
ggplot(filtered_data, aes(x = income_category, y = Death_rate, fill = income_category)) + 
  geom_boxplot() + 
  labs(
    title = "Death Rate by Income Category",
    x = "Income Category",
    y = "Death Rate"
  ) + 
  theme_minimal() + 
  scale_fill_manual(values = c("Revenu < 38800" = "blue", "Revenu > 70321" = "red"))
```

The data reveal significant disparities between income categories in terms of infection and mortality rates. Low-income households earning less than 38,880 dollars have a mean infection rate of 32.08 percent, which is higher than the 28.68 percent observed among high-income households earning more than 70,321 dollars. Confidence intervals (31.35 to 32.82 percent for low-income households and 27.89 to 29.47 percent for high-income households) confirm the reliability of these estimates, though the difference remains moderate. However, the gap in mortality rates is more pronounced. Low-income households exhibit a mean mortality rate of 1.83 percent, nearly double that of high-income households, which is 0.88 percent. This disparity is further supported by non-overlapping confidence intervals (1.75 to 1.90 percent for low-income households and 0.84 to 0.92 percent for high-income households), underscoring the significant impact of economic inequality on severe health outcomes.

These findings emphasize the significance of social determinants in shaping pandemic outcomes. Poverty itself may not have an immediate impact, but its downstream effects such as lack of health insurance, economic vulnerability, and reduced access to resources play a critical role in influencing health outcomes during crises. Building on this, we will examine the role of education, focusing on high school and bachelor’s degree attainment, in promoting public health awareness and adherence to preventive measures. Additionally, we will analyze health insurance coverage, with particular attention to uninsured populations, including children and the elderly, to understand how gaps in the U.S. healthcare system impacted the management of critical cases. Finally, while the unemployment data reflects the pre pandemic period of 2019, it provides a crucial baseline for understanding broader economic vulnerabilities that contributed indirectly, through effects such as poverty and limited healthcare access, to shaping pandemic preparedness and resilience.

### C - Unemployment and Insurance Rate
